<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>swift on Alfred Nutile</title><link>https://alfrednutile.info/tags/swift/</link><description>Recent content in swift on Alfred Nutile</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Sat, 12 Feb 2022 06:32:07 -0400</lastBuildDate><atom:link href="https://alfrednutile.info/tags/swift/index.xml" rel="self" type="application/rss+xml"/><item><title>SwiftUI: Switching to a page when a user clicks on notification</title><link>https://alfrednutile.info/posts/swift_notifications/</link><pubDate>Sat, 12 Feb 2022 06:32:07 -0400</pubDate><guid>https://alfrednutile.info/posts/swift_notifications/</guid><description><h3 id="quick-notes-to-self-on-how-to-have-the-user-go-to-a-specific-page-after-clicking-on-a-notification-in-ios">Quick Notes to Self on how to have the user go to a specific page after clicking on a Notification in iOS.</h3><img src="images/notifications.gif" width="600"><p>The two main articles that helped are<a href="https://stackoverflow.com/questions/62504400/programmatically-change-to-another-tab-in-swiftui">https://stackoverflow.com/questions/62504400/programmatically-change-to-another-tab-in-swiftui</a></p><p><a href="https://stackoverflow.com/questions/62309251/how-can-i-open-a-specific-view-in-swiftui-when-a-user-opens-a-notification">https://stackoverflow.com/questions/62309251/how-can-i-open-a-specific-view-in-swiftui-when-a-user-opens-a-notification</a></p><p>One helped me to see how in a more “modern” SwiftUI way get the state of the Notification from the UIDelegate up to the SwiftUI view. The second one was key since I am using TabView and needed to change the view when this was updated.</p><p>This will assume you have Firebase notifications already working. The pattern I used there can be seen in<a href="https://designcode.io/swiftui-advanced-handbook-push-notifications-part-1">https://designcode.io/swiftui-advanced-handbook-push-notifications-part-1</a> some really great material here as well as<a href="https://seanallen.teachable.com">https://seanallen.teachable.com</a></p><h2 id="setup-up-notificationmanager">Setup up<code>NotificationManager</code></h2><p>I followed the first post but I was a bit more specific since I just, for now, have one page.</p><p>For example when that person setups up the<code>pageToNavigateTo</code> a number I just set it to</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-swift" data-lang="swift">notificationManager?.pageToNavigationTo =<span style="color:#e6db74">"myRecalls"</span></code></pre></div><p>This means I had to set the class as well</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-swift" data-lang="swift"><span style="color:#66d9ef">class</span><span style="color:#a6e22e">NotificationManager</span>: ObservableObject {<span style="color:#66d9ef">static</span><span style="color:#66d9ef">let</span> shared = NotificationManager()
@Published<span style="color:#66d9ef">var</span> pageToNavigationTo : String?
}</code></pre></div><p>From here, I followed along with everything else till they get to the page with the Navigation since I am using tabs. That is where the second article comes in. I set my tags on the Tabs and then set the default.</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-swift" data-lang="swift"> @State<span style="color:#66d9ef">private</span><span style="color:#66d9ef">var</span> tabSelection =<span style="color:#e6db74">"topics"</span><pre><code>&lt;span style="color:#66d9ef">var&lt;/span> body: some View {
ZStack {
VStack {
&lt;span style="color:#66d9ef">if&lt;/span>(authState.signedIn) {
TabView(selection: &lt;span style="color:#960050;background-color:#1e0010">$&lt;/span>tabSelection) {
TopicsParentsView()
.tabItem {
Label(&lt;span style="color:#e6db74">&amp;#34;Topics&amp;#34;&lt;/span>, systemImage: &lt;span style="color:#e6db74">&amp;#34;house&amp;#34;&lt;/span>)
}
.tag(&lt;span style="color:#e6db74">&amp;#34;topics&amp;#34;&lt;/span>)
MyRecallsView() .tabItem {
Label(&lt;span style="color:#e6db74">&amp;#34;My Recalls&amp;#34;&lt;/span>, systemImage: &lt;span style="color:#e6db74">&amp;#34;person.crop.rectangle&amp;#34;&lt;/span>)
}
.tag(&lt;span style="color:#e6db74">&amp;#34;myRecalls&amp;#34;&lt;/span>)
RecallsView() .tabItem {
Label(&lt;span style="color:#e6db74">&amp;#34;Recalls&amp;#34;&lt;/span>, systemImage: &lt;span style="color:#e6db74">&amp;#34;list.dash&amp;#34;&lt;/span>)
}
.tag(&lt;span style="color:#e6db74">&amp;#34;recalls&amp;#34;&lt;/span>)
AccountView()
.tabItem {
Label(&lt;span style="color:#e6db74">&amp;#34;My Account&amp;#34;&lt;/span>, systemImage: &lt;span style="color:#e6db74">&amp;#34;person.crop.circle&amp;#34;&lt;/span>)
}
.tag(&lt;span style="color:#e6db74">&amp;#34;account&amp;#34;&lt;/span>)</code></pre><p/></pre></div><p>That was it. After a rebuild my notifications brought me right to the page. For me the articles, when I actually followed all the details, worked perfectly. Below are the full examples.</p></p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-swift" data-lang="swift">@main<span style="color:#66d9ef">struct</span><span style="color:#a6e22e">TotalRecallsIoApp</span>: App {
@UIApplicationDelegateAdaptor(AppDelegate.<span style="color:#66d9ef">self</span>)<span style="color:#66d9ef">var</span> appDelegate<pre><code>&lt;span style="color:#66d9ef">let&lt;/span> notificationManager = NotificationManager()
&lt;span style="color:#66d9ef">func&lt;/span> &lt;span style="color:#a6e22e">setUpdNotificationManager&lt;/span>() {
appDelegate.notificationManager = notificationManager
}
&lt;span style="color:#66d9ef">var&lt;/span> body: some Scene {
&lt;span style="color:#66d9ef">let&lt;/span> authState = AuthState()
WindowGroup {
HomeView()
.environmentObject(authState)
.environmentObject(notificationManager)
.onAppear {
setUpdNotificationManager()
}
}
}</code></pre><p>}</p><p><span style="color:#66d9ef">class</span><span style="color:#a6e22e">NotificationManager</span>: ObservableObject {<span style="color:#66d9ef">static</span><span style="color:#66d9ef">let</span> shared = NotificationManager()
@Published<span style="color:#66d9ef">var</span> pageToNavigationTo : String?
}</code></pre></div><p>Then the AppDelegate</p></p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-swift" data-lang="swift">@available(iOS<span style="color:#ae81ff">10</span>,<span style="color:#f92672">*</span>)<span style="color:#66d9ef">extension</span><span style="color:#a6e22e">AppDelegate</span> : UNUserNotificationCenterDelegate {<p><span style="color:#75715e">// Receive displayed notifications for iOS 10 devices.</span><span style="color:#66d9ef">func</span><span style="color:#a6e22e">userNotificationCenter</span>(<span style="color:#66d9ef">_</span> center: UNUserNotificationCenter,
willPresent notification: UNNotification,
withCompletionHandler completionHandler: @escaping (UNNotificationPresentationOptions) -> Void) {<span style="color:#66d9ef">let</span> userInfo = notification.request.content.userInfo</p><pre><code>&lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> messageID = userInfo[gcmMessageIDKey] {
print(&lt;span style="color:#e6db74">&amp;#34;Message ID: &lt;/span>&lt;span style="color:#e6db74">\(&lt;/span>messageID&lt;span style="color:#e6db74">)&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>)
}
print(userInfo)
&lt;span style="color:#75715e">// Change this to your preferred presentation option&lt;/span>
completionHandler([[.banner, .badge, .sound]])</code></pre><p>}</p><pre><code>&lt;span style="color:#66d9ef">func&lt;/span> &lt;span style="color:#a6e22e">application&lt;/span>(&lt;span style="color:#66d9ef">_&lt;/span> application: UIApplication, didRegisterForRemoteNotificationsWithDeviceToken deviceToken: Data) {
}
&lt;span style="color:#66d9ef">func&lt;/span> &lt;span style="color:#a6e22e">application&lt;/span>(&lt;span style="color:#66d9ef">_&lt;/span> application: UIApplication, didFailToRegisterForRemoteNotificationsWithError error: Error) {
}</code></pre><p><span style="color:#66d9ef">func</span><span style="color:#a6e22e">userNotificationCenter</span>(<span style="color:#66d9ef">_</span> center: UNUserNotificationCenter,
didReceive response: UNNotificationResponse,
withCompletionHandler completionHandler: @escaping () -> Void) {<span style="color:#66d9ef">let</span> userInfo = response.notification.request.content.userInfo</p><pre><code>&lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> messageID = userInfo[gcmMessageIDKey] {
print(&lt;span style="color:#e6db74">&amp;#34;Message ID from userNotificationCenter didReceive: &lt;/span>&lt;span style="color:#e6db74">\(&lt;/span>messageID&lt;span style="color:#e6db74">)&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>)
}
print(userInfo)
print(&lt;span style="color:#e6db74">&amp;#34;DEBUG: User clicks on notifications&amp;#34;&lt;/span>)
notificationManager?.pageToNavigationTo = &lt;span style="color:#e6db74">&amp;#34;myRecalls&amp;#34;&lt;/span>
print(&lt;span style="color:#e6db74">&amp;#34;DEBUG: Done setting page &lt;/span>&lt;span style="color:#e6db74">\(&lt;/span>notificationManager?.pageToNavigationTo&lt;span style="color:#e6db74">)&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>)
completionHandler()</code></pre><p>}
}</code></pre></div><p>Finally the page with TabView</p></p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-swift" data-lang="swift"><span style="color:#66d9ef">import</span><span style="color:#a6e22e">SwiftUI</span><span style="color:#66d9ef">import</span><span style="color:#a6e22e">Firebase</span><p><span style="color:#66d9ef">struct</span><span style="color:#a6e22e">HomeView</span>: View {</p><pre><code>@EnvironmentObject &lt;span style="color:#66d9ef">var&lt;/span> authState: AuthState
@EnvironmentObject &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">var&lt;/span> notificationManager: NotificationManager
@State &lt;span style="color:#66d9ef">var&lt;/span> email = &lt;span style="color:#e6db74">&amp;#34;&amp;#34;&lt;/span>
@State &lt;span style="color:#66d9ef">var&lt;/span> password = &lt;span style="color:#e6db74">&amp;#34;&amp;#34;&lt;/span>
@State &lt;span style="color:#66d9ef">var&lt;/span> signedIn = &lt;span style="color:#66d9ef">false&lt;/span>
@State &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">var&lt;/span> tabSelection = &lt;span style="color:#e6db74">&amp;#34;topics&amp;#34;&lt;/span>
&lt;span style="color:#66d9ef">var&lt;/span> body: some View {
ZStack {
VStack {
&lt;span style="color:#66d9ef">if&lt;/span>(authState.signedIn) {
TabView(selection: &lt;span style="color:#960050;background-color:#1e0010">$&lt;/span>tabSelection) {
TopicsParentsView()
.tabItem {
Label(&lt;span style="color:#e6db74">&amp;#34;Topics&amp;#34;&lt;/span>, systemImage: &lt;span style="color:#e6db74">&amp;#34;house&amp;#34;&lt;/span>)
}
.tag(&lt;span style="color:#e6db74">&amp;#34;topics&amp;#34;&lt;/span>)
MyRecallsView() .tabItem {
Label(&lt;span style="color:#e6db74">&amp;#34;My Recalls&amp;#34;&lt;/span>, systemImage: &lt;span style="color:#e6db74">&amp;#34;person.crop.rectangle&amp;#34;&lt;/span>)
}
.tag(&lt;span style="color:#e6db74">&amp;#34;myRecalls&amp;#34;&lt;/span>)
RecallsView() .tabItem {
Label(&lt;span style="color:#e6db74">&amp;#34;Recalls&amp;#34;&lt;/span>, systemImage: &lt;span style="color:#e6db74">&amp;#34;list.dash&amp;#34;&lt;/span>)
}
.tag(&lt;span style="color:#e6db74">&amp;#34;recalls&amp;#34;&lt;/span>)
AccountView()
.tabItem {
Label(&lt;span style="color:#e6db74">&amp;#34;My Account&amp;#34;&lt;/span>, systemImage: &lt;span style="color:#e6db74">&amp;#34;person.crop.circle&amp;#34;&lt;/span>)
}
.tag(&lt;span style="color:#e6db74">&amp;#34;account&amp;#34;&lt;/span>)
}
} &lt;span style="color:#66d9ef">else&lt;/span> {
LoginView()
}
}
.onAppear {
authState.signedIn = authState.isSignedIn
}
.onReceive(notificationManager.&lt;span style="color:#960050;background-color:#1e0010">$&lt;/span>pageToNavigationTo) {
&lt;span style="color:#66d9ef">guard&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> notificationSelection = $0 &lt;span style="color:#66d9ef">else&lt;/span> { &lt;span style="color:#66d9ef">return&lt;/span> }
&lt;span style="color:#66d9ef">self&lt;/span>.tabSelection = notificationSelection
}
}
}</code></pre><p>}</p><p><span style="color:#66d9ef">struct</span><span style="color:#a6e22e">HomeView_Previews</span>: PreviewProvider {</p><pre><code>@EnvironmentObject &lt;span style="color:#66d9ef">var&lt;/span> firebaseManager: FirebaseManager
&lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">var&lt;/span> previews: some View {
&lt;span style="color:#66d9ef">let&lt;/span> authState = AuthState()
HomeView().environmentObject(authState)
}</code></pre><p>}</code></pre></div></p></description><tags>swiftui, swift, note2self</tags></item></channel></rss>